# HNJX2021 日志

## Day 1

> 期望得分：$115 = 60 + 30 + 25$  
> 实际得分：$75 = 20 + 30 + 25$

</br>

### 题目情况

**array**

考试只会 $O(n ^ 2)$ 的 DP，因为有个限制条件去不掉，感觉不能斜率优化。结果暴力还因为没开 ```long long``` 丢了……  
听 $\texttt{I}\color{red}\texttt{makf}$ 讲题才恍然大悟发现错误的转移是不如正确的转移优的，所以直接转移就行。然后由于需要支持任意位置插点动态维护凸包，于是要用 CDQ 分治做。

经验：遇到不好做的 DP 转移限制可以考虑证明**不满足限制不优**从而使得转移一视同仁。

</br>

**difference**

第一次做交互题！  
只会做 $M_1 + M_2 \geq n$ 的情况，因为想不到怎么一次询问求出多个位置的值。  
正解太妙啦！首先查询全体求出极差，用 $1$ 个 $\log$ 的询问次数二分前缀求出 $max$ 或 $min$，位置记作 $p$。  
然后将所有下标按位二进制分组，查询出二进制下第 $i$ 位为 $1$ 的下标集合 $S_i \cup p$。  
然后就能确定每一位与 $a_p$ 的差值了。具体来说对于第 $a_k$，差值就是 $k$ 所在的每一个 $S_j$ 集合都出现过的数。  
最后，两个 $\operatorname{qry_1}$ 用来确定极值的具体数值。

经验：遇到奇怪的题从特殊情况入手，如这题确定序列从确定极值入手。

</br>

**randomxor**

只会暴力的 $O(Ln2^n)$ 的状压 DP。

</br>
</br>

## Day 2

> 期望得分：$80 = 40 + 40 + 0$  
> 实际得分：$50 = 40 + 10 + 0$

</br>

### 题目情况

**q**

发现可以将原图拆成 $25$ 个子图（即对原图行列按 $\bmod 5$ 意义下剩余系分组）。这样就将一次操作变成了 $5$ 次子图中的矩形覆盖。答案即为所有子图的矩形面积并。  
矩形面积并是扫描线的经典应用，但由于我 sb 了，一开始想到用二维线段树维护（红红火火恍恍惚惚），然后自然就没了。最后写了差分的暴力 $O(n^2)$ 收场。

</br>

**i**

想到了 $O(n^2)$ 的暴力枚举断边然后换根 DP，用桶维护后缀和最后统计。但不知为何又挂了。

正解依然是换根 DP，考虑哪些点一定在最大独立集中，然后总方案数减去不合法方案数。

</br>

**u**

又是一道交互题。

完全不会。

正解 nb！假设询问 $qry (x, y) = k$，那么 $(x + k, y + k)$ 与 $(x - k, y - k)$ 两点必有一个在直线上。  
考虑只在直线 $y = x$ 上询问，像二分一样，每次查询 $mid$，然后得到 $qry (mid, mid) = p$，继续递归解决 $[l, p]$ 与 $[p, r]$。

</br>
</br>

## Day 3

> 期望得分：$? = ? + ? + 0$  
> 实际得分：$20 = 10 + 10 + 0$  
> 青山毒瘤！

</br>

### 题目情况

**merge**

猜了个结论，按最高位从高位往低位做，每一位内部做合并然后传给下一位。然后大样例 $\color{red}\texttt{WA}$ 了一整年。  

现在也只会 $O(Tnw^2)$ 的做法。首先可以发现：

$$
\lfloor \frac{(a \mid b)}{2} \rfloor = (a \mid b) \gg 1 = (a \gg 1) \mid (b \gg 1)
$$

不难想到，如果提前得知哪些数要进行合并，可以先将其他数删去。对于只有合并操作的集合 $S$，记 $d_i$ 为 $i$ 被合并的次数，则有：

$$
Ans = \sum_{i \in S} (i \gg d_i) \\
\sum_{i \in S} \frac{1}{2^{d_i}} = 1
$$

自证不难。（认真.jpg）  
再推广一下，加上删除操作，发现对于一个 $Ans$，只要满足下式：

$$
\sum_{i = 1}^{n} \frac{1}{2^{d_i}} \geq 1
$$

就一定合法。因为一定能选出一个 $S \subseteq \left\{1, 2, 3, \dots n \right\}$ 使得 $\sum_{i \in S} \frac{1}{2^{d_i}} = 1$。

然后就贪心从高位到低位尝试把答案（初始化为全 $1$ 串）的这一位置 $0$。具体就是求出最大的 $\sum_{i = 1}^{n} \frac{1}{2^{d_i}}$ 判断其是否 $\geq 1$。

</br>

**pass**

推了个结论，一个串合法当且仅当包含一个长度 $> 1$ 的奇回文串。然后写了 PAM 死活 $\color{red}\texttt{WA}$。 
下了考才发现还有一种情况也行：被偶回文串覆盖。

正解分治，没太看懂，以后再补。

</br>

**worship**

肝前两题肝了一年，甚至没时间看题。

大概看了看题解。  
首先需要一个结论：每次操作只需考虑二元环。证明可反证非二元环不优且环上 $A$ 中编号最小点必与 $B$ 中点成环。  
然后可以转化为网络流模型，发现可以用模拟最大流做到最优。

</br>
</br>

## Day 4

> 期望得分：$102 = 70 + 12 + 20$  
> 实际得分：$88 = 70 + 8 + 10$

</br>

### 题目情况

**name**

写了 $O(n ^ 2)$ 的暴力加上两个特殊性质的分。  

正解二分一个长度，然后上点分治进行 Check，对于一个分治中心，所有跨过它的回文串必然会被分为一个长串和短串。对短串存 Hash 值，并在长串处检验是否有合法短串，还要判断中间那一部分是不是回文。时间复杂度 $2 \times \log$。

</br>

**tree**

不是很懂。

</br>

**yyds**

只会最裸的暴力。

正解有点意思。首先发现整除关系是一个偏序关系，于是 $f (S)$ 即为最长反链长度。   
然后有一个结论：最长反链只会选 $(n + 1, 2n]$ 中的数。具体证明可以从充分必要性考虑。然后考虑这其中每个数对多少个 $S$ 集合有贡献即可。

</br>
</br>

## Day 5

> 期望得分：$40 = 40 + 0 + 0$  
> 实际得分：$80 = 80 + 0 + 0$

</br>

### 题目情况

**fall**

考试时很懵逼，只会 $60\operatorname{pts}$ 的暴力分。由于其中两档情况太多，于是只实现了 $40 \operatorname{pts}$。

正解类似 联合省选 2021 Day2 T1 那道 **gem** 的树剖做法（$\texttt{s}\color{red}\texttt{hm}$ 教我的），由于不同查询的权值的路径不唯一，且暴力向下跳的复杂度太高，考虑树剖后然后优化跳重链的过程。  
具体来说，对于每一条重链，数字 $k$ 能跳过其一段**前缀**当且仅当 $k$ 处于这段前缀每个点的区间并中。这可以用线段树二分做到 $O(\log_2 n)$ 查询。然后经过轻边继续跳重链。一条路径上轻边个数上界为 $O(\log_2 n)$，于是总查询复杂度为 $O(\log_2 n)$。修改直接线段树单点修改即可。总复杂度 $O(n \log_2 n + q \log_2 n)$。

经验：对于树上跳路径问题，**向下跳且后继不唯一**时可使用重剖优化跳重链的过程。

**tros**

不会。

正解大概是考虑算每个位置对答案的贡献然后推式子。

**tree**

考试时想出了一个有道理的做法，可惜最后没调出来。  

正解不是很懂。

### 其他

HNJX 连续考 8 Days 不休息还是很吃力啊……眼睛很酸，并且很疲惫。Day 4, 5 直接睡了一下午，并且白天考试时也无法集中精力。难搞！

</br>
</br>

## Day 6

> 期望得分：$104 = 40 + 31 + 33$  
> 实际得分：$43 = 0 + 10 + 33$

</br>

### 题目情况

**match**

首先解决没有奇数的情况。  
考虑对于每次操作 $(x, y)$，$x$ 在前视作**出点**，$y$ 在后视作**入点**。每次操作即视作**出点**与**入点**之间的**匹配**。即将 $a_i$ 拆成两个大小为 $\frac{a_i}{2}$ 的部分，一部分为**出点**，一部分为**入点**。然后跑**最小费用最大流**即可。

若奇数有奇数个则无解。否则，为保证**出点**与**入点**个数相等，将一半奇数的 $\lfloor \frac{a_i}{2} \rfloor$ 作为出点，一半的 $\lceil \frac{a_i}{2} \rceil$ 作为出点。这可用 $2^k$ 枚举然后对于每种情况取 $\min$。

</br>

**sort**

考试写了 $k = 2$ 的情况，不知为何挂掉了。  

考虑将 $k = 2$ 的情况扩展，设 $f_{u, i}$ 表示拼接完点 $u$ 的子树后左端点 $\geq i$ 时右端点的最小值。再设 $g_{i, S}$ 表示考虑拼接 $u$ 的子树区间，当前已拼接集合为 $S$，左端点为 $i$ 时的最小右端点。转移如下：

$$
g_{i, S} = \min \{ g_{k, Sn} \} (k > g_{i, S})
$$

</br>

**infect**

如果 $i$ 被感染后能感染 $j$，则连边 $(i, j)$。得到的新图缩点后入度为 $0$ 的**强连通分量**个数即为答案。暴力连边是 $O(n^2)$ 的。  

考虑使用**点分治**优化建图。对于每层分治中心，DFS 求出每个点到其的 $\mathrm{dis}$，排序后每个点向一段前缀连边。于是上个前缀优化建图就完了。

</br>
</br>

## Day 7

> 期望得分：$30 = 30 + 0 + 0$  
> 实际得分：$0 = 0 + 0 + 0$

</br>

### 题目情况

**good**

一眼看上去就像个 **消消乐DP** 问题。但可惜是 $O(n^4)$ 的，过不去。

正解考虑区间 DP，设 $f (i, j)$ 表示**删完** $[i, j]$ 的最大价值。

转移分两种情况：  
1. $i, j$ 分开删除
2. $i, j$ 一起删除

分别处理转移就好。最后计算答案时再用一个一维 DP，处理不一定要删完的条件。

经验：后来想了想为什么可以不用 **消消乐DP** 处理。由于本题的特殊性质，一个“好”的串的差分数组一定是单调不增的，即“好”的串的权值形似一个山峰。（先增后减）转移枚举峰顶 $k$ 转移，此时“好”的串 $i, \dots, k, \dots j$ 的长度是**已知的**。（“好”的串相邻两项差值为 $1$）因此不需要像消消乐问题一样格外开一维记录长度。

</br>

**color**

太累了，写了 **good** 后趴下睡了会，一起来就没多少时间了。感觉 **music** 比较阳间，于是看那道题去了。

正解没看，目前会了个根号分治的做法。

</br>

**music**

考试时想了个 DP，用基本的容斥思想处理。但枚举不合法的串是基于 **最长Border** 的，想不清怎么处理有交的情况。

正解是枚举 **最小Border**，因为一个经典结论：一个串的 **最小Border** 长度必然不超过串长的 $\frac{1}{2}$。然后套个分治 FFT 再优化一下常数就可以了。

</br>
</br>

## Day 8

> 期望得分：$40 + 4 + ?$  
> 实际得分：$74 = 15 + 4 + 55$

</br>

### 题目情况

**game**

开场立刻想到个 DP，能够线性判定一个不含 "?" 的串的合法性。题目要求有多少中填法使得串合法，感觉是个暴力的大 DP。再加上对于状态的转移想的不是很清楚，于是没写了。最后十分钟测下大样例里的一个情况突然发现过不去，于是炸了。

正解直接 DP 套 DP 求解方案数。

</br>

**tree**

SG 函数，不是很懂。

</br>

**socialbutterfly**

随机化有 $50\mathrm{pts}$？什么？直接贪心有 $100\mathrm{pts}$？离谱。

正解是一个网络流模型：最大权闭合子图。