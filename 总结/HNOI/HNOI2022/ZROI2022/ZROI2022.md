# 省选十连测

## Day 1

**01串**

神秘双射，将题目转换为给定 $n - 1$ 个 `<` 或 `>`，求有多少个长为 $n$ 的排列，从前往后满足这 $n-1$ 对大小关系。

**做菜**

首先根据邻项交换，推出必定按 $b_i$ 降序服务客人。假设要服务 $[1, n]$ 的所有客人，那么答案为 $\max \{b_i + \sum_{j=1}^i a_j \}$。但这样正着做不好 DP，因为需要记录 $\sum a_j$。如果倒过来，那么可以这样计算：

```cpp
ans = 0;
for (int i=n; i>=1; --i) ans = max (ans, b[i]) + a[i];
```

按 $b_i$ 升序考虑所有客人，设状态 $f (i, j)$ 表示前 $i$ 个客人服务了 $j$ 的 $ans_{\min}$。  
转移为 $f (i, j) = \min \{ f (i - 1, j), \max \{f (i - 1, j - 1), b_i\} + a_i \}$。

这样就完成了确定 $a_i$ 后的做法，复杂度 $O(n ^ 2)$。

继续挖掘 $f$ 的性质，发现在某一时刻，若 $f (i - 1, j) \leq b_i$，那么 $f (*, j)$ 就不再变化（因为从 $f (i - 1, j -1)$ 一定不优于直接继承）。由于 $f (i, *)$ 是递增的，所以 $f (i - 1, j) > b_i$ 的 $j$ 是一段后缀，假设为 $[k, i - 1]$。  
考虑维护 $j \geq k$ 的 $f (i - 1, j)$ 的差分数组 $d$，满足：

$$
d_j=
\begin{cases}
f (i - 1, j) - b_i &j = k\\[2ex]
f (i - 1, j) - f (i - 1, j - 1) &j > k
\end{cases}
$$

有个结论就是 $d_j$ 任意时刻都是单调递增的，可以归纳证明。根据这个结论，如果存在 $p \geq k$ 满足 $d_{p - 1} \leq a < d_{p}$，说明 $j < p$ 时转移会直接继承，$j \geq p$ 时会从 $f (i - 1, j - 1)$ 处转移。  
进行完这些转移后 $d$ 相当于在 $d_p$ 前插入了一项 $a_i$。  
用优先队列维护 $d$，每次加入一个元素 $i$，令 $db = b_i - b_{i-1}$，放到数轴上来看，每个 $f (i - 1, j)$ 对应数轴上一点，$b_i$ 相当于一条线 $x = b_i$，加入元素 $i$ 相当于原来的线向正方向移动 $db$ 长度，不断弹出或减少队首的 $d$ 即可。恰好弹出 $k$ 个元素时减少的总量即为 $k$ 的答案。

计数待补。