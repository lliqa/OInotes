[TOC]

## 2022/5/10

### 或

不同的 $2$ 的次幂模 $3$ 结果只可能为 $1, 2$。  
考虑容斥，强制一些位置只能为 $0$，其他位置任意。DP 计数满足条件的 $3$ 的倍数。

### 走

* 这里位置编号为 $[0, n - 1]$。

朴素的状压 DP 状态数过多。  
考虑优化状态数：  
* 不关心位置标号，只关心已经走过的位置和当前位置的相对关系。因此可以把当前的位置按死在 $0$，每次移动时把走过的位置相对移动。这样做还有个好处是可以把环当成链来考虑。
* 现在 $0$ 为当前位置。如果 $[1, n - 1]$ 中存在两对 $11$，那么这两对 $11$ 中间的位置一定无法经过，全都视为经过即可。
* 由于是环，并且向左向右的操作一样，只保留 $[1, n - 1]$ 比翻转后的字典序小的状态。

统计答案：  
$E  =\sum len \times p$，遍历每一个终止状态，$len$ 为长度，$p$ 为概率。终止状态不好记录，把 $p$ 拆成 $len$ 份在路径上所有非终点处贡献。每个非终止状态的贡献为 $\sum p_{leaf} = p$。同时也省去了记录 $len$。