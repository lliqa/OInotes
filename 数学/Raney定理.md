[TOC]

### 引入

Catalan 一个经典的组合意义是：
分别有 $n$ 个 $1, -1$，将这 $2n$ 个数排成一个序列，满足所有前缀和 $\geq 0$ 的序列总数即为第 $n$ 项 Catalan 数。  
可以用 Raney 定理来证明上述结论。

### 描述

对于任意一个长为 $n$ 的整数序列且满足总和为 $1$，在所有循环同构的序列中有且仅有一个满足所有前缀和 $>0$。


> 为什么总和一定要为 $1$？  
> 因为可以不考虑循环同构相同的情况。如果满足 $\forall 1 \leq i \leq n, a_i = a_{i+m}$，说明存在 $\gcd (n, m)$ 个大小为 $\frac{n}{\gcd (n, m)}$ 的等价类。每个等价类中元素相同，所有等价类元素总和为 $\frac{n}{\gcd (n, m)}$ 倍数。  
> 当总和为 $1$ 时，$\frac{n}{\gcd (n, m)} \mid 1 \implies \frac{n}{\gcd (n, m)} = 1 \implies n | m$。此时不存在循环同构相同。


### 证明

* 一种方法是数形结合，见具体数学 P301
* 一种方法是直接分析。

两者都给出了明确的构造方案，合法的序列开头是原序列前缀和最小处的后一位。

### 应用

回到引入部分，考虑完成结论的证明。  
可以在第 $0$ 位放一个 $1$，条件改写为总和 $=1$，前缀和 $> 0$，符合 Raney 定理的适用范围。总共的序列数为 $\dbinom {2n+1}{n}$，每 $2n+1$ 个循环同构的序列中只有一个合法，合法序列数即为 $\dbinom {2n+1}{n}\dfrac{1}{2n+1}$。

### 扩展

#### m-Raney 序列

##### 定义

仅包含 $1, 1-m$ 的序列，满足总和 $=1$，前缀和 $>0$。  

##### 性质

如果包含 $n$ 个 $1-m$，那么有 $n(m-1) + 1$ 个 $1$。

一个长度为 $nm+1 (n>0)$ 的 m-Raney 序列 $a$，最后一位一定为 $1-m$。且去掉最后一位后，前 $nm$ 位能被划分成 $m$ 个 m-Raney 序列。

证明：  
记 $s_n = \sum_{i=1}^n a_i$。  
有 $s_{nm+1} = 1$，如果最后一位为 $1$，有 $s_{nm} = 0$，不合法。因此最后一位为 $1-m$，此时 $s_{nm} = m$。找到前 $nm$ 位中 $1 \sim m$ 最靠后的出现位置，记为 $p_{1 \sim m}$。分析可知子区间 $[1, p_1], (p_1, p_2], \dots, (p_{m-1}, p_m]$ 均为 m-Raney 序列。

##### 计数

根据 Raney 定理可知序列数是：

$$
\dbinom {nm+1}{n}\dfrac{1}{nm+1}
$$

根据划分的性质可以递推求解：  
记 $C (n, m)$ 表示长为 $nm + 1$ 的 m-Raney 序列数。

$$
C (n, m) = \sum_{\sum_{i=1}^{m}n_i = n - 1} \prod_{i=1}^m C (n_i, m)
$$

$m = 2$ 即为 Catalan 数。