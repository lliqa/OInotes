[TOC]

### 树上高斯消元

运用于一些类树上游走题，每个点的状态与父亲、儿子有关。对于点 $u$，设其父亲为 $v$，将其状态表示为 $f(u) = k_u f(v) + b_u$ 的形式。然后由于树无环，就能从叶子往根递推，$b_{root}$ 即为答案。

### 整数期望 (概率) 公式

$$
E(x)=\sum_{i=1}^{\infty}i \cdot P(x = i) = \sum_{i=1}^{\infty}P(x=i)\sum_{j=1}^i1 \\
=\sum_{j=1}^{\infty}\sum_{i=j}^{\infty}P(x=i) = \sum_{i=1}^{\infty}P(x \geq i)
$$

### 有用结论

给一个集合和一个性质，集合中的元素 $i$ 满足该种性质的概率为 $Pf(i)$。  
设 $x$ 为满足该种性质的元素 $y \in S$ 的个数，求 $E (x^2)$。

$$
E (x^2) = \sum_{a, b \in S}Pf (a, b)
$$

感性理解：

拆分贡献，$x^2$ 可以转化成 “从 $S$ 中先后取出并放回两个元素，假设第一次取 $a$，第二次取 $b$，所有取法中 $a, b$ 均满足性质的数量。” 两次取元素是独立的，每次取中满足性质的元素方案都有 $x$ 种，总方案就是 $x^2$。因此只需统计每对二元组的期望贡献。

理性证明：

$$
E (x^2) = \sum_{i} P(x = i) i^2 = \sum_{T \subseteq S}Pf (T) |T|^2 = \sum_{T \subseteq S}Pf (T) \sum_{a, b \in S} [a, b \in T]\\
= \sum_{a, b \in S}\sum_{T \subseteq S}Pf (T)[a, b \in T] = \sum_{a, b \in S} Pf (a, b)
$$

还有个更好的证明：

$$
E(x^2) = E \left((\sum_{i \in S}[ok (i)])^2 \right) = E \left(\sum_{i, j \in S}[ok (i, j)] \right) = \sum_{i, j \in S}E \left([ok (i, j)] \right) = \sum_{a, b \in S}Pf (a, b)
$$

### 做题方法

不要脑补意会，感性理解天地灭，代数推导保平安！


### 习题选做

[Luogu P3600 随机数生成器](https://www.luogu.com.cn/problem/P3600)

> 首先发现值域很小, 只有 $2 \times 10^3$ .
>
> 答案为 $\large{E(X)=\sum_{i=1}^x i \cdot P(X=i)}$ , 直接枚举 $i$ , 首要问题为计算 $P(X=i)$ .
>
> $P(X=i)$ 不怎么好算, 但 $P(X \leq i)$ 就好算多了.
>
> 差分一下可得 $\large{P(X=i)=P(X \leq i) - P(X \leq (i - 1))}$ . 接下来的问题是计算 $P(X \leq i)$.
>
> 把 $[1, x]$ 中 $\leq i$ 的数看作 $0$ , $ > i$ 的数看作 $1$ , 于是序列转化成了一个 $01$ 串, 问题在于计算有多少个 $01$ 串满足下面这个要求:
>
> 1. 每一个询问区间 $[l_i, r_i]$ 中**存在** $0$ .
>
> 考虑 DP , 设 $F(i, j)$ 表示考虑区间 $[1, j]$ 中放 $i$ 个 $0$, 且 $j$ 必放 $0$ , 使得所有 $l_k \leq j$ 的区间符合要求的方案数.
>
> 可以想到, 合法的转移位置一定是一段区间, 即
> $$
> F(i, j) = \sum_{k < j}^{j-1} F(i - 1, k)
> $$
> 如果存在询问区间 $[l, r]$ 使得 $k - 1 < l \leq k \leq r < j$ , 那么 $[k, j - 1]$ 即是对于 $j$ 合法的转移区间.
>
> 暴力 DP 是 $O(n^3)$ , 但是不难发现对于递增的 $j$, 其最远转移点 $k$ 也是递增的. 双指针乱杀即可 $O(n^2) .$

