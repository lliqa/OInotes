# 目录

1. 必败态与核
2. 有向图游戏与 $\operatorname{SG}$ 函数
3. 经典模型
     * Nim 游戏及扩展
     * 无向图的删边游戏

</br>
</br>
</br>

## 有向图的核

### 定义

1. 外固集

> $\texttt{def}$：对于有向图中的点集 $S$，若任意不在 $S$ 的点存在一条指向 $S$ 内点的边，则 $S$ 为**外固集**。

2. 内固集

> $\texttt{def}$：对于有向图中的点集 $S$，若 $S$ 内点两两无边，则 $S$ 为**内固集**。

</br>

### 应用

$\texttt{lem}$：在有向图游戏中，若有核存在，则一方存在不败策略。

$\texttt{proof}$：

考虑这样一个对应关系：

$$
\begin{cases}
\texttt{核 $\iff$ 必败态}\\
\texttt{核外 $\iff$ 必胜态}\\
\end{cases}
$$

如果当前状态位于核内，由于核为内固集，则下一步必须出核；  
如果当前状态在核外，由于核为外固集，则下一步可以入核。  
又由于必败态位于核内，则某一方可以控制另一方永远位于核内状态，而自己位于核外。

$\texttt{lem}$：有限结点的 DAG 存在唯一的核。

$\texttt{proof}$：

数学归纳法。  
对于无出度结点必然在核内。  
对于有出度结点：  
* 后继均为非核结点，则在核内。
* 否则在不在核内。

</br>
</br>
</br>

## 经典模型

### Nim 游戏及扩展

#### **阶梯 Nim**

> 有 $n + 1$ 个位置（$0 \sim n$），第 $i$ 个位置有 $i$ 个石子。每次操作可选择 $[1, n]$ 中任意一个位置 $i$ ，将 $[1, a_i]$ 个石子移到 $i - 1$ 位置上。

$\texttt{conclusion}$：

该问题等价于只考虑奇数位置石子的 Nim 游戏。即先手有必胜策略当且仅当：

$$
\left( \oplus_{i \equiv 1 \pmod 2} a_i \right)  \not= 0
$$

> 其中 $\oplus$ 为异或操作。

$\texttt{proof}$：

若两人均只移动奇数位置的石子，则显然成立。  
若仅考虑奇数位置的石子先手必胜，则后手会尝试移动偶数位置的石子（不然根据 Nim 游戏的结论必败）。假设后手移动第 $i(i \equiv 0 \pmod 2)$ 位的石子到第 $i - 1$ 位，那么先手可以将等量的石子从 $i - 1$ 位移动到 $i - 2$ 位。这样对仅考虑奇数位的 Nim 和没有任何影响。  
综上，阶梯 Nim 等价于只考虑奇数位置石子的 Nim 游戏，因此奇数堆石子数的 Nim 和不为 $0$ 时先手必胜。

</br>

#### **Nim-k**

> Nim 游戏的改版，从每次只能选一堆石子到能够选 $[1, k]$ 堆石子，从中删去正整数的石子。（每堆数量可以不相同）

$\texttt{conclusion}$：

先手必胜当且仅当二进制下每一位为 $1$ 的石子堆数对 $(k + 1)$ 取模皆为 $0$。

> 二进制下第 $i$ 位为 $1$ 的石子堆数对 $(k + 1)$ 取模的结果记为 $a_i$，上述条件记作“好条件”。

$\texttt{proof}$：

考虑证明满足“好条件”的状态在核中，反之不在。  

内固集 $\texttt{proof}$：

考虑满足“好条件”的状态 $S$，由于必须删去正整数的石子，所以必然存在二进制下某一位为 $1$ 的数量发生变化，设该位为 $x$。由于 $S$ 中 $a_x = 0$，若要使得后继状态仍满足 $a_x = 0$，则必须至少将 $k + 1$ 个石子在第 $x$ 位下 $1 \to 0$。$k + 1 > k$，不合法。  
故满足“好条件”的所有状态构成的集合为内固集。

外固集 $\texttt{proof}$：

对于不满足“好条件”的状态 $S$，考虑构造出一个合法操作方案到达一个满足“好条件”的后继状态。 

> 合法：操作堆数 $\in [1, k]$，删去石子数为正整数。

首先找到不满足“好条件”的二进制最高位 $k_1$，设 $a_{k_1} = m(m < k + 1)$。要使 $k_1$ 位合法，只能将这 $m$ 个数第 $k_1$ 位 $1 \to 0$。  
然后找到不满足“好条件”的第二高位 $k_2$，设 $a_{k_2} = r(r < k + 1)$。  
要使 $k_2$ 位合法，肯定是尽量用当前已操作过的 $m$ 个石子堆，因为要保证操作的堆数 $\leq k$。  
假设 $m$ 个石子堆中石子数在第 $k_2$ 位上为 $1$ 的有 $x$ 堆，为 $0$ 的有 $y$ 堆，显然有 $x + y = m$。

从上往下优先考虑决策：（$1, 2$ 可互换）

1. $x \geq r$，直接将 $x$ 中 $r$ 堆 $1 \to 0$。
2. $y \geq k + 1 - r$，直接将 $y$ 中 $k + 1 - r$ 堆 $0 \to 1$。（由于这些石子堆在更高位 $1 \to 0$，因此在低位 $0 \to 1$ 仍能保证删去的石子数为正整数。）
3. 前两个决策用的是已操作过的石子堆，而该决策会增加操作过的石子堆数，不优。因此除非前两个决策均不合法，才会启用该决策。此时有：$\begin{cases}x < r\\y < k + 1 - r\end{cases}$ 选取不在 $x$ 堆中且 $k_2$ 位为 $1$ 的 $r - x$ 堆石子 $1 \to 0$（只能 $1 \to 0$，因为是操作的最高位），$x$ 堆也都 $1 \to 0$。然后验证操作堆数 $\leq k$，$(m + r - x = y + r) < k + 1$，合法。

依次考虑每一位即可得到一个合法的方案使得 $S$ 到达一个满足“好条件”的后继状态，故满足“好条件”的所有状态构成的集合为外固集。

综上所述，满足“好条件”的所有状态构成的集合同时为内外固集，即该集合为一个核。  
所以核内状态均为必败态，结论得证。

</br>

#### **Anti-Nim**

> 与 Nim 游戏的区别在于获胜规则，Anti-Nim 中取到最后一颗石子为负。

$\texttt{conclusion}$：

先手必胜当且仅当满足以下任意一个条件：

1. 所有堆石子数均为 $1$，且共有偶数堆石子。
2. 至少存在一个堆石子数 $>1$ 且 Nim和 $\not= 0$

$\texttt{proof}$：

> 记 Nim 和为 $k$，必胜态为 `Y`，必败态为 `N`。

1. 所有堆石子数均为 $1$
   1. 偶数堆：`Y`
   2. 奇数堆：`N`
2. 有一堆石子数 $>1$，此时 $k > 0$
   1. 奇数堆：将石子数 $>1$ 的那堆 $\to 1$，转为 $1.2$，`Y`
   2. 偶数堆：将石子数 $>1$ 的那堆 $\to 0$，转为 $1.2$，`Y`
3. 至少两堆石子数 $>1$
   1. $k = 0$，仅能转化为以下状态：
      1. 有一堆石子数 $>1$，`Y`
      2. $3.2$
   2. $k > 0$，一定存在一种取法使得 $k = 0$，此时一定有至少两堆石子数 $>1$。即转为 $3.1$。分析可知 $3.2$ 为 `Y`，$3.1$ 为 `N`。

综上可知结论正确。

</br>
</br>

### 无向图的删边游戏

#### **树的删边游戏**

> 规则如下：  
> 给出一个 $n$ 个结点的有根树，两人轮流删去树上一条边，删去边后不与根相连的部分将被删去。  
> 谁无法操作则判负。

$\texttt{conclusion}$：

$$
\operatorname{SG}(p)=
\begin{cases}
0, &\texttt{$p$ 为叶节点}\\[2ex]
\operatorname{Xor}\{\operatorname{SG}(q) + 1\}(\texttt{$q$ 为 $p$ 儿子}), &\texttt{otherwise}
\end{cases}
$$

$\texttt{proof}$：

数学归纳法。

> $n$ 为树的节点数。

1. $n \leq 2$ 时显然成立。
2. 假设 $< n$ 均成立，然后证明 $n$ 个节点时成立。

将 $2.$ 证明分为两部分：

1. 根节点有 $1$ 个儿子（自证，因为没图不好描述）
2. 根节点有 $>1$ 个儿子（结合 $1.$ 发现就是 Nim 游戏）

#### **无向图的删边游戏**

> 与树的删边游戏类似，只不过树 $\to$ 无向图。

$\texttt{conclusion}$：

我们可以对无向图做如下改动：  
将图中的任意一个偶环缩成一个新点，任意一个奇环缩成一个新点加一个新边；所有连到原先环上的边全部改为与新点相连。  
这样的改动不会影响图的 SG 值。

$\texttt{proof}$：

$\texttt{Fusion Principle}$ 定理